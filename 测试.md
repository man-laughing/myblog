

##### 不可重复读


* 基础数据、隔离级别

```bash
mysql> show variables like '%iso%';
+---------------+----------------+
| Variable_name | Value          |
+---------------+----------------+
| tx_isolation  | READ-COMMITTED |
+---------------+----------------+
1 row in set (0.00 sec)

mysql> 
mysql> select * from t1;
+----+-------+
| id | name  |
+----+-------+
| 10 | hello |
+----+-------+
1 row in set (0.00 sec)

mysql> 
```

* Session1

```bash
mysql> begin;
Query OK, 0 rows affected (0.00 sec)
mysql> 
mysql> select * from t1 where id = 10;   //同事务内，第一次读
+----+-------+
| id | name  |
+----+-------+
| 10 | hello |
+----+-------+
1 row in set (0.00 sec)

mysql> 
```

* Session2

```bash
mysql> begin;
Query OK, 0 rows affected (0.00 sec)

mysql> select * from t1 where id = 10;
+----+-------+
| id | name  |
+----+-------+
| 10 | hello |
+----+-------+
1 row in set (0.00 sec)
mysql> 
mysql> update t1 set name = "world" where id = 10;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select * from t1 where id = 10;
+----+-------+
| id | name  |
+----+-------+
| 10 | world |
+----+-------+
1 row in set (0.00 sec)

mysql> commit;
Query OK, 0 rows affected (0.01 sec)

mysql>  
```

* Session1

```bash
 mysql> select * from t1 where id = 10;  //同事务内，第二次读，可以看到id=10的数据已经变了。。。这就是”不可重复读“
+----+-------+
| id | name  |
+----+-------+
| 10 | world |
+----+-------+
1 row in set (0.00 sec)

mysql> 

```

 

#### 幻读

* 基础数据、隔离级别

```bash

mysql> show variables like '%iso%';
+---------------+----------------+
| Variable_name | Value          |
+---------------+----------------+
| tx_isolation  | READ-COMMITTED |
+---------------+----------------+
1 row in set (0.00 sec)

mysql> select * from t2;
+------+
| age  |
+------+
|    5 |
|    6 |
+------+
2 rows in set (0.00 sec)

```


* Session1

```bash
mysql> begin;
Query OK, 0 rows affected (0.00 sec)

mysql> select * from t2 where  age > 5;   //同事务内，第一次读
+------+
| age  |
+------+
|    6 |
+------+
1 row in set (0.00 sec)

mysql>  
```

* Session2 

```bash
mysql> begin;
Query OK, 0 rows affected (0.00 sec)

mysql> select * from t2;
+------+
| age  |
+------+
|    5 |
|    6 |
+------+
2 rows in set (0.00 sec)

mysql> 
```


* Session2

```bash
mysql> 
mysql> insert into t2 values (9);
Query OK, 1 row affected (0.00 sec)

mysql> select * from t2;
+------+
| age  |
+------+
|    5 |
|    6 |
|    9 |
+------+
3 rows in set (0.00 sec)

mysql> 
mysql> commit;
Query OK, 0 rows affected (0.00 sec)

mysql> 

```

* Session1

```bash
mysql> select * from t2 where  age > 5;    //同事务内，第二次读，发现多出了一行数据，似乎就是产生了“幻像（幻读）”

+------+ 
| age  |
+------+
|    6 |
|    9 |
+------+
2 rows in set (0.00 sec)

mysql> 

```